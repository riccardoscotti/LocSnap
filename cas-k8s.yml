apiVersion: v1
kind: Service
metadata:
  name: backend-service
spec:
  selector: 
    app: backend
  ports:
    - protocol: 'TCP'
      port: 8080
      targetPort: 8080
      nodePort: 30002
  type: NodePort
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend-deployment
  labels: 
    app: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: backend
  template:
    metadata: 
      labels:
        app: backend
    spec: 
      containers:
        - name: backend
          image: node:latest
          workingDir: /backend
          ports: 
          - containerPort: 8080
          args:
            - '/bin/sh'
            - '-c'
            - "rm -rf node_modules; npm install; npm start"
          volumeMounts:
            - mountPath: /backend
              name: backend-dir
      volumes:
        - name: backend-dir
          hostPath:
            path: /home/christian/Universita/Magistrale/ContextAware/Esame/LocSnap/backend2
---
# apiVersion: v1
# kind: Service
# metadata:
#   name: frontend-service
# spec:
#   selector: 
#     app: frontend
#   ports:
#     - protocol: 'TCP'
#       port: 8001
#       targetPort: 8001
#   type: LoadBalancer
# ---
# apiVersion: apps/v1
# kind: Deployment
# metadata:
#   name: frontend-deployment
#   labels: 
#     app: frontend
# spec:
#   replicas: 1
#   selector:
#     matchLabels:
#       app: frontend
#   template:
#     metadata: 
#       labels:
#         app: frontend
#     spec: 
#       containers:
#         - name: frontend
#           image: mrpotrol/frontend:cas
#           ports: 
#           - containerPort: 8001
# ---
apiVersion: v1
kind: Service
metadata:
  name: database-service
spec:
  selector: 
    app: database
  ports:
    - protocol: 'TCP'
      port: 5432
      targetPort: 5432
      nodePort: 30001
  type: NodePort
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: database-deployment
  labels: 
    app: database
spec:
  selector:
    matchLabels:
      app: database
  replicas: 1
  template:
    metadata:
      labels:
        app: database
    spec:
      containers:
        - name: database
          image: postgis/postgis
          ports:
            - containerPort: 5432
              name: "postgres"
          volumeMounts:
            - mountPath: /var/lib/postgresql/data
              name: postgres-db
          env:
            - name: POSTGRES_DB
              value: contextawarerc
            - name: POSTGRES_USER
              value: postgres
            - name: POSTGRES_PASSWORD
              value: postgres
          resources:
            limits:
              memory: 2Gi
              cpu: "2"
      volumes:
        - name: postgres-db
          hostPath:
            path: /home/christian/Universita/Magistrale/ContextAware/Esame/LocSnap/postgres_data